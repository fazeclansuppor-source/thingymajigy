<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8" />
  <title>MacroStack â€“ Admin Bans</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="h-full bg-gray-900 text-gray-100 p-10 font-mono">
  <h1 class="text-3xl font-bold mb-8">ğŸ›¡ï¸ Ban Manager</h1>

  <div id="app" class="space-y-10">
    <!-- ID bans ---------------------------------------------------- -->
    <section>
      <h2 class="text-xl mb-4">Discord ID bans</h2>
      <form id="idForm" class="flex gap-4 mb-4">
        <input id="idInput" type="text" placeholder="Snowflakeâ€¦" required
               class="flex-1 px-3 py-2 bg-gray-800 rounded" />
        <button class="px-4 py-2 bg-indigo-600 rounded hover:bg-indigo-700">
          â• Add
        </button>
      </form>
      <table id="idTable" class="w-full text-sm"></table>
    </section>

    <!-- Fingerprint bans ------------------------------------------- -->
    <section>
      <h2 class="text-xl mb-4">Fingerprint bans</h2>
      <form id="fpForm" class="flex gap-4 mb-4">
        <input id="fpInput" type="text" placeholder="visitorIdâ€¦" required
               class="flex-1 px-3 py-2 bg-gray-800 rounded" />
        <button class="px-4 py-2 bg-indigo-600 rounded hover:bg-indigo-700">
          â• Add
        </button>
      </form>
      <table id="fpTable" class="w-full text-sm"></table>
    </section>
  </div>

<script>
const $ = id => document.getElementById(id);

async function api(path, opts = {}) {
  const r = await fetch(path, {
    credentials: 'include',
    headers: { 'Content-Type': 'application/json' },
    ...opts
  });
  if (!r.ok) throw new Error(await r.text());
  return r.json();
}

function render(table, rows, type) {
  table.innerHTML = rows.length
    ? rows
        .map(
          v => `<tr>
                  <td class="py-1 pl-1">${v}</td>
                  <td class="px-2">
                    <button data-v="${v}" data-t="${type}"
                            class="text-red-400 hover:text-red-200">ğŸ—‘ï¸</button>
                  </td>
                </tr>`
        )
        .join('')
    : `<tr><td class="py-1 italic text-gray-500">â€” none â€”</td></tr>`;
}

async function refresh() {
  const data = await api('/admin/bans');
  render($('idTable'), data.ids, 'id');
  render($('fpTable'), data.fp,  'fp');
}

/* ---------- updated click handler ---------- */
$('app').addEventListener('click', async e => {
  const btn = e.target.closest('button');
  if (!btn || !btn.hasAttribute('data-v')) return;

  const { v, t } = btn.dataset;               // t = 'id' | 'fp', v may be ''
  const url = v
    ? `/admin/ban/${t}/${encodeURIComponent(v)}`
    : `/admin/ban/${t}`;                      // no trailing slash when v == ''

  await api(url, { method: 'DELETE' });
  refresh();
});

/* ----- add + refresh forms stay the same ----- */
$('idForm').addEventListener('submit', async e => {
  e.preventDefault();
  await api('/admin/ban', {
    method: 'POST',
    body: JSON.stringify({ type: 'id', value: $('idInput').value.trim() })
  });
  $('idInput').value = '';
  refresh();
});

$('fpForm').addEventListener('submit', async e => {
  e.preventDefault();
  await api('/admin/ban', {
    method: 'POST',
    body: JSON.stringify({ type: 'fp', value: $('fpInput').value.trim() })
  });
  $('fpInput').value = '';
  refresh();
});

refresh();
</script>
</body>
</html>
